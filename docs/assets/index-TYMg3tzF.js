var be=Object.defineProperty;var Ie=(t,i,e)=>i in t?be(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var d=(t,i,e)=>Ie(t,typeof i!="symbol"?i+"":i,e);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function Y(){const t=globalThis.Phaser;if(!t)throw new Error("Phaser runtime not found on globalThis. Make sure to load the CDN script before importing the game.");return t}const Me=Y();class Le extends Me.Scene{constructor(){super("Boot")}preload(){}create(){this.scene.start("Play")}}const k=Y(),Re={Grunzer:4942970,Späher:5018988,Captain:16765286,Anführer:15681391,Herausforderer:10258872,König:1149618},ke={leader:16170336,ally:5032432,support:9485933,rival:15681391,hidden:16739179},ve=128,we=140;function ae(t){const e=t.split(" ")[0]??t;return e.length>12?`${e.slice(0,11)}…`:e}class Ce{constructor(i){d(this,"scene");d(this,"container");d(this,"visuals");d(this,"focusRing");d(this,"frame");d(this,"portrait");d(this,"labelBg");d(this,"nameText");d(this,"detailText");d(this,"hover");d(this,"blur");d(this,"currentOfficer");d(this,"currentScale",1);d(this,"pulseTween");d(this,"currentFocus",null);this.scene=i.scene,this.hover=i.onHover,this.blur=i.onBlur,this.currentOfficer=i.officer,this.container=this.scene.add.container(i.x,i.y),this.container.setSize(ve,we),this.container.setDepth(1);const e=new k.Geom.Circle(0,0,58);this.container.setInteractive({hitArea:e,hitAreaCallback:k.Geom.Circle.Contains,useHandCursor:!0}),this.visuals=this.scene.add.container(0,0),this.focusRing=this.scene.add.circle(0,0,54,16777215,0),this.focusRing.setStrokeStyle(0,16777215,0),this.frame=this.scene.add.circle(0,0,46,16777215,1),this.frame.setStrokeStyle(2,858922,.65),this.portrait=this.scene.add.image(0,0,i.portraitKey),this.portrait.setDisplaySize(88,88),this.visuals.add([this.focusRing,this.frame,this.portrait]),this.labelBg=this.scene.add.rectangle(0,50,92,36,725272,.78).setOrigin(.5,0),this.nameText=this.scene.add.text(0,52,ae(i.officer.name),{fontFamily:"monospace",fontSize:"12px",color:"#f7f9fc",align:"center"}).setOrigin(.5,0).setWordWrapWidth(84),this.detailText=this.scene.add.text(0,68,"",{fontFamily:"monospace",fontSize:"10px",color:"#a9b7c6",align:"center"}).setOrigin(.5,0).setWordWrapWidth(84),this.container.add([this.visuals,this.labelBg,this.nameText,this.detailText]),this.container.on("pointerover",()=>{this.container.setDepth(2),this.scene.input.setDefaultCursor("pointer"),this.hover&&this.hover(this.currentOfficer)}),this.container.on("pointerout",()=>{this.container.setDepth(1),this.scene.input.setDefaultCursor("default"),this.blur&&this.blur()}),this.update(i.officer,{highlight:i.highlight,focus:null,scale:i.scale??1})}applyScale(i){const e=Math.max(.55,Math.min(1.25,i));if(Math.abs(e-this.currentScale)<.01)return;this.currentScale=e,this.visuals.setScale(e),this.labelBg.setPosition(0,48*e),this.labelBg.setSize(90*e,34*e),this.labelBg.displayWidth=90*e,this.labelBg.displayHeight=34*e;const s=Math.max(10,Math.round(12*e)),n=Math.max(9,Math.round(10*e)),r=Math.max(70,Math.round(84*e));this.nameText.setFontSize(s),this.nameText.setY(this.labelBg.y+4*e),this.nameText.setWordWrapWidth(r),this.detailText.setFontSize(n),this.detailText.setY(this.nameText.y+14*e),this.detailText.setWordWrapWidth(r)}stopPulse(){this.pulseTween&&(this.pulseTween.stop(),this.visuals.setScale(this.currentScale)),this.pulseTween=void 0}applyHighlight(i,e){this.stopPulse(),e&&i?this.pulseTween=this.scene.tweens.add({targets:this.visuals,duration:260,scale:this.currentScale*1.08,yoyo:!0,repeat:-1,ease:k.Math.Easing.Sine.InOut}):this.visuals.setScale(this.currentScale)}applyFocus(i,e){if(this.currentFocus=e,e&&i){const s=ke[e];this.focusRing.setStrokeStyle(4,s,.95),this.focusRing.setVisible(!0)}else this.focusRing.setStrokeStyle(0,16777215,0),this.focusRing.setVisible(!1)}update(i,e={}){this.currentOfficer=i,e.scale!==void 0&&this.applyScale(e.scale),this.nameText.setText(ae(i.name)),this.detailText.setText(`${i.rank} • Lv ${i.level}`);const s=i.status==="ALIVE",n=s?Re[i.rank]:2237739;this.frame.setFillStyle(n,s?1:.35),this.frame.setStrokeStyle(2,858922,s?.65:.35),this.container.setAlpha(s?1:.55),this.portrait.setAlpha(s?1:.45),this.labelBg.setFillStyle(s?725272:1777446,s?.8:.5),this.applyHighlight(s,e.highlight),this.applyFocus(s,e.focus??this.currentFocus)}setPosition(i,e,s={}){if(s.immediate){this.container.setPosition(i,e);return}const n=k.Math.Distance.Between(this.container.x,this.container.y,i,e);if(n<4){this.container.setPosition(i,e);return}this.scene.tweens.add({targets:this.container,x:i,y:e,duration:200+n*.4,ease:k.Math.Easing.Sine.InOut})}setScale(i){this.applyScale(i),this.visuals.setScale(this.currentScale)}getPosition(){return{x:this.container.x,y:this.container.y}}destroy(){this.stopPulse(),this.container.destroy(!0)}}const v={FEAST:"🍖",OVERFALL:"⚔️",ASSASSINATION:"🗡️",HUNT:"🏹",MONSTER_HUNT:"🐉",PURGE:"🔥"},w={FEAST:"Festmahl",OVERFALL:"Überfall",ASSASSINATION:"Attentat",HUNT:"Jagd",MONSTER_HUNT:"Monsterjagd",PURGE:"Säuberung"},Be={FEAST:"Bindungen stärken",OVERFALL:"Beute sichern",ASSASSINATION:"Ziel ausschalten",HUNT:"Trophäe erlegen",MONSTER_HUNT:"Bestie besiegen",PURGE:"Rivalen säubern"};function We(t,i){return t?t.relationships.friends.includes(i.id)||i.relationships.friends.includes(t.id):!1}function Pe(t,i){return t?t.relationships.rivals.includes(i.id)||i.relationships.rivals.includes(t.id):!1}function Q(t,i,e){if(t.initiator===i.id)return"Ausrufer";const s=t.hiddenRoles.find(n=>n.who===i.id);if(s)switch(s.role){case"ASSASSIN":return"Assassine";case"TRAITOR":return"Rivale (verdeckt)";case"LOYALIST":return"Loyalist"}return Pe(e,i)?"Rivale":We(e,i)?"Verbündeter":"Supporter"}function Ne(t,i,e){return`${w[t]} @ ${i} (${e})`}function De(t,i){return i.state==="RESOLVED"?!1:i.initiator===t.id?!0:i.participants.includes(t.id)}function Fe(t,i,e){const s=i.find(o=>De(t,o));if(!s)return{summary:"Freies Spiel"};const n=e(s.initiator),r=Q(s,t,n);return{summary:Ne(s.type,s.location,r),warcallId:s.id,role:r}}function $e(t){const i=new Set;return t&&(t.newWarcalls.forEach(e=>{i.add(e.initiator),e.participants.forEach(s=>i.add(s)),e.hiddenRoles.forEach(s=>i.add(s.who))}),t.resolved.forEach(e=>{const{warcall:s}=e;i.add(s.initiator),s.participants.forEach(n=>i.add(n)),e.victorious.forEach(n=>i.add(n)),e.defeated.forEach(n=>i.add(n)),e.casualties.forEach(n=>i.add(n.officerId))}),t.replacements.forEach(e=>i.add(e.id))),i}const ee=Object.freeze({columns:5,cellWidth:120,cellHeight:110,originX:120,originY:120});function Z(t,i,e){let s=i,n=e;return n<s&&([s,n]=[n,s]),Math.min(Math.max(t,s),n)}function le(t,i){const e=Math.max(1,Math.floor(i));if(!Number.isFinite(t.width)||!Number.isFinite(t.height)||t.width<=0||t.height<=0)return ee;const s=Math.max(t.width,1),n=Math.max(t.height,1),r=Z(s*.1,48,s/2),o=Z(n*.1,48,n/2),a=Math.max(1,s-r*2),c=Math.max(1,n-o*2);if(a<1||c<1)return ee;const l=Math.max(1,Math.floor(a/96)),h=Math.max(1,Math.floor(c/110)),u=Math.max(1,Math.min(6,l,e)),y=Math.ceil(Math.sqrt(e));let S=Z(y,1,u);const g=Math.max(1,Math.min(u,Math.ceil(e/h)));S<g&&(S=g);let T=Math.max(1,Math.ceil(e/S));for(;T>h&&S<u;)S+=1,T=Math.max(1,Math.ceil(e/S));const p=a/S,A=c/T,E=t.x+r+p/2,m=t.y+o+A/2;return{columns:S,cellWidth:p,cellHeight:A,originX:E,originY:m}}function ce(t,i=ee){return Array.from({length:t},(e,s)=>{const n=s%i.columns,r=Math.floor(s/i.columns);return{x:i.originX+n*i.cellWidth,y:i.originY+r*i.cellHeight}})}const f=96,he=40,te=40,He=[1515819,2042419,2825517,1847085,3352095,2237749,2760499,1912379],_e=[5072707,5201718,5663817,6123584,6322767],de=[3755818,4611382,4346931,3623466],ue=[16183765,15589588,14870234,15856619,16249054],fe=[4014171,5731728,11887990,28023,16758531,14034984],ye=[15919588,15129810,14273203,13350815],me=[{kind:"SCAR",color:16739179},{kind:"SCAR",color:15893634},{kind:"PAINT",color:4756975},{kind:"PAINT",color:2792847},{kind:"TATTOO",color:16234497},{kind:"PIERCING",color:15330543},{kind:"HAIR",color:4869737},{kind:"HELM",color:7107965},{kind:"BRAND",color:13073919},{kind:"MASK",color:197726}],Se=["NONE","SMALL","LARGE"],pe=["DEFAULT","ANGLED","HEAVY","CURVED"];function x(t,i,e){const s=(t>>16&255)*(1-e)+(i>>16&255)*e,n=(t>>8&255)*(1-e)+(i>>8&255)*e,r=(t&255)*(1-e)+(i&255)*e;return Math.max(0,Math.min(255,Math.round(s)))<<16|Math.max(0,Math.min(255,Math.round(n)))<<8|Math.max(0,Math.min(255,Math.round(r)))}function ze(){const t=[];let i=0;for(const e of _e)for(const s of He){const n=me[i%me.length],r=Se[i%Se.length],o=pe[i%pe.length],a=ue[i%ue.length],c=fe[i%fe.length],l=de[i%de.length],h=ye[i%ye.length];t.push({background:s,skin:e,jaw:l,eyes:a,iris:c,tusk:h,adornment:n,hornStyle:r,browStyle:o}),i+=1}return t.slice(0,te)}const Ve=ze();function Ge(t,i){const e=x(i.skin,16710368,.35);t.fillStyle(e,1),(i.hornStyle==="SMALL"||i.hornStyle==="LARGE")&&(t.fillTriangle(48,10,38,26,56,26),t.fillTriangle(f-48,10,f-56,26,f-38,26),i.hornStyle==="LARGE"&&(t.fillTriangle(60,6,50,20,66,24),t.fillTriangle(f-60,6,f-66,24,f-50,20)),t.lineStyle(2,x(e,1776931,.55),.9),t.strokeTriangle(48,10,38,26,56,26),t.strokeTriangle(f-48,10,f-56,26,f-38,26))}function Ue(t,i){switch(t.lineStyle(4,x(i.skin,1184274,.6),.8),i.browStyle){case"ANGLED":t.beginPath(),t.moveTo(36,38),t.lineTo(46,34),t.lineTo(56,38),t.strokePath(),t.beginPath(),t.moveTo(f-36,38),t.lineTo(f-46,34),t.lineTo(f-56,38),t.strokePath();break;case"HEAVY":t.fillStyle(x(i.skin,197379,.75),.9),t.fillRoundedRect(32,34,32,8,4),t.fillRoundedRect(f-64,34,32,8,4);break;case"CURVED":t.lineStyle(3,x(i.skin,723723,.7),.8),t.strokePoints([{x:34,y:38},{x:46,y:32},{x:58,y:38}],!1,!0),t.strokePoints([{x:f-34,y:38},{x:f-46,y:32},{x:f-58,y:38}],!1,!0);break;default:t.lineStyle(3,x(i.skin,1579032,.6),.8),t.beginPath(),t.moveTo(34,38),t.lineTo(56,38),t.strokePath(),t.beginPath(),t.moveTo(f-34,38),t.lineTo(f-56,38),t.strokePath();break}}function Ke(t,i){t.fillStyle(i.eyes,1),t.fillEllipse(42,48,18,12),t.fillEllipse(f-42,48,18,12),t.fillStyle(i.iris,1),t.fillCircle(42,48,5),t.fillCircle(f-42,48,5),t.fillStyle(0,.85),t.fillCircle(42,48,2.6),t.fillCircle(f-42,48,2.6)}function Ye(t,i){t.fillStyle(i.tusk,1),t.fillEllipse(38,68,14,18),t.fillEllipse(f-38,68,14,18),t.fillStyle(x(i.tusk,1118481,.4),.9),t.fillEllipse(36,68,8,10),t.fillEllipse(f-36,68,8,10)}function je(t,i){const e=x(i.skin,592137,.7);t.lineStyle(3,e,.9),t.strokePoints([{x:42,y:76},{x:f/2,y:82},{x:f-42,y:76}],!1,!0),t.lineStyle(2,x(e,16777215,.2),.6),t.strokePoints([{x:42,y:70},{x:f/2,y:74},{x:f-42,y:70}],!1,!0)}function Xe(t,i){const{adornment:e}=i;switch(e.kind){case"SCAR":{t.lineStyle(3,e.color,.9),t.beginPath(),t.moveTo(34,28),t.lineTo(f-28,f-30),t.strokePath(),t.lineStyle(1,16777215,.6),t.beginPath(),t.moveTo(36,30),t.lineTo(f-30,f-32),t.strokePath();break}case"PAINT":{t.fillStyle(e.color,.75),t.fillRect(28,40,f-56,14),t.fillTriangle(28,54,40,78,52,54),t.fillTriangle(f-28,54,f-40,78,f-52,54);break}case"TATTOO":{t.lineStyle(3,e.color,.85),t.beginPath(),t.moveTo(f/2,18),t.lineTo(f/2-12,34),t.lineTo(f/2+12,34),t.closePath(),t.strokePath(),t.strokeCircle(f/2,52,10);break}case"PIERCING":{t.lineStyle(2,e.color,.9),t.strokeCircle(f/2,84,6),t.fillStyle(e.color,.9),t.fillCircle(f/2-8,84,3),t.fillCircle(f/2+8,84,3);break}case"HAIR":{t.fillStyle(e.color,.95),t.fillEllipse(f/2,18,52,26),t.fillRect(28,24,f-56,12);break}case"HELM":{t.fillStyle(e.color,.95),t.fillRect(24,16,f-48,18),t.fillEllipse(f/2,16,f-40,28),t.lineStyle(3,x(e.color,16777215,.3),.9),t.strokeRect(24,16,f-48,18);break}case"BRAND":{t.lineStyle(4,e.color,.9),t.strokeRoundedRect(30,54,f-60,24,6),t.lineStyle(2,x(e.color,16777215,.3),.6),t.beginPath(),t.moveTo(36,66),t.lineTo(f-36,66),t.strokePath();break}case"MASK":{t.fillStyle(e.color,.92),t.fillRoundedRect(30,38,f-60,28,10),t.lineStyle(2,x(e.color,16777215,.25),.9),t.strokeRoundedRect(30,38,f-60,28,10);break}}}function qe(t,i,e){const s=t.add.graphics();s.fillStyle(e.background,1),s.fillCircle(f/2,f/2,f/2);const n=x(e.jaw,1053986,.15);s.fillStyle(n,1),s.fillCircle(f/2,f/2+18,he+6),s.fillStyle(e.skin,1),s.fillCircle(f/2,f/2,he),Ge(s,e),Ue(s,e),Ke(s,e),Ye(s,e),je(s,e),Xe(s,e),s.generateTexture(i,f,f),s.destroy()}function J(t){const i=[];for(let e=0;e<te;e+=1){const s=`officer-portrait-${e}`;t.textures.exists(s)||qe(t,s,Ve[e]),i.push(s)}return i}function Ze(t){let i=0;for(let e=0;e<t.length;e+=1)i=(i<<5)-i+t.charCodeAt(e),i|=0;return i}function Je(t){return Math.abs(Ze(t))%te}const Oe=20,Qe=2,et=4,tt=10,it={Grunzer:{promoteAtMerit:40,demoteBelowMerit:null},Späher:{promoteAtMerit:90,demoteBelowMerit:20},Captain:{promoteAtMerit:160,demoteBelowMerit:60},Anführer:{promoteAtMerit:240,demoteBelowMerit:120},Herausforderer:{promoteAtMerit:360,demoteBelowMerit:200},König:{promoteAtMerit:null,demoteBelowMerit:260}},st={Berserker:1.15,Taktiker:1.1,Feigling:.85,UnsterblichGeruecht:1.05,Tierbaendiger:1.05,Diplomat:1,Schleicher:1.05,GraueEminenz:1},nt={Taktiker:.05,Diplomat:.03,GraueEminenz:.06},rt=["Berserker","Taktiker","Feigling","UnsterblichGeruecht","Tierbaendiger","Diplomat","Schleicher","GraueEminenz"],ot=["Eisenfaust","Schlackenmaehne","Blutfaenger","Glutfaust","Ascheklaue"],j=["Schlackengrube","Schädelhügel","Schwarzmoor","Aschepass","Blutforst","Fungusgrotte"],at=["Gor","Muz","Shag","Ug","Sna","Krak","Naz","Bog","Ruk","Lug"],lt=["zug","gash","rin","lok","ga","hka","grok","dur","dug","dash"],ct=["Bestienjäger","Schattenklinge","Schinder","Lagermeister","Brandstifter","Seher"];function ht(t,i,e){return i.filter(s=>s.id!==t.id&&s.traits.includes(e)).length}function B(t,i){let e=10+t.level*4+t.gearScore+t.merit*.15;for(const n of t.traits){const r=st[n]??1;e*=r;const o=nt[n]??0;if(o>0){const a=ht(t,i,n);e*=1+a*o}}t.relationships.bloodOathWith&&i.some(n=>n.id===t.relationships.bloodOathWith)&&(e*=1.15);const s=i.filter(n=>t.relationships.friends.includes(n.id)).length;return s>0&&(e*=1+s*.05),t.relationships.rivals.some(n=>i.some(r=>r.id===n))&&(e*=.9),e*=.95+t.personality.aggression*.1,e*=.9+t.personality.loyalty*.1,e}function M(t){return t.length===0?0:t.reduce((i,e)=>i+B(e,t),0)}function dt(t,i){return(i.participants.includes(i.initiator)?i.participants:[i.initiator,...i.participants]).map(s=>t.officers.find(n=>n.id===s&&n.status==="ALIVE")).filter(s=>!!s)}function ut(t,i){return t.officers.find(e=>e.id===i)}function I(t){return Number.isNaN(t)?.5:Number.isFinite(t)?Math.min(1,Math.max(0,t)):t>0?1:0}function Ee(t,i){return i<=0?t>0?1:0:I(t/(t+i))}function ft(t){return t==="MONSTER_HUNT"?26:16}function yt(t,i,e){const s=i.hiddenRoles.find(l=>l.role==="ASSASSIN"),n=s?e.find(l=>l.id===s.who):e[0],o=e.filter(l=>l.id!==(n==null?void 0:n.id)).sort((l,h)=>h.level-l.level)[0];if(!n||!o)return .5;const a=B(n,[n]),c=B(o,[o]);return I(a/(c*1.15))}function mt(t,i){let e=.05+t.personality.opportunism*.25-t.personality.loyalty*.2;return t.relationships.rivals.includes(i.id)&&(e+=.15),t.relationships.bloodOathWith===i.id&&(e=0),I(e)}function St(t,i,e){const s=e.find(u=>u.id===i.initiator);if(!s)return .5;const n=e.filter(u=>u.id!==s.id);if(n.length===0)return .8;const r=Math.max(1,Math.floor(n.length/2)),o=[s,...n.slice(0,r)],a=n.slice(r);if(a.length===0)return .9;const c=o.slice(1).reduce((u,y)=>u+mt(y,s),0),l=M(o)*(1-c*.2),h=M(a);return Ee(l,h)}function pt(t,i){const e=M(i),s=ft(t.type)*i.length;return I(e/(s*1.1))}function gt(t,i,e){const s=e.find(h=>h.id===i.initiator);if(!s)return .5;const n=e.filter(h=>h.id===s.id||i.hiddenRoles.some(u=>u.who===h.id&&u.role==="LOYALIST")),r=e.filter(h=>!n.includes(h));if(r.length===0)return .85;const o=M(n),a=M(r),c=Ee(o,a),l=r.length*.05;return I(c*(1-l)+.1)}function Tt(t){if(t.length<=1)return .95;const e=t.slice(1).map(s=>.15).reduce((s,n)=>s+n,0);return I(.95-e*.1)}function At(t,i,e){switch(i.type){case"ASSASSINATION":return yt(t,i,e);case"OVERFALL":return St(t,i,e);case"PURGE":return gt(t,i,e);case"HUNT":case"MONSTER_HUNT":return pt(i,e);case"FEAST":default:return Tt(e)}}function Ot(t,i){const e=dt(t,i);if(e.length===0)return .5;const s=ut(t,i.initiator);return!s||s.status!=="ALIVE"?.5:I(At(t,i,e))}class Et{constructor(i){d(this,"state");this.state=i>>>0}next(){let i=this.state;return i^=i<<13,i^=i>>>17,i^=i<<5,this.state=i>>>0,this.state/4294967295}int(i,e){return Math.floor(this.next()*(e-i+1))+i}chance(i){return this.next()<i}pick(i){if(i.length===0)throw new Error("Cannot pick from empty array");return i[this.int(0,i.length-1)]}shuffle(i){const e=[...i];for(let s=e.length-1;s>0;s--){const n=this.int(0,s);[e[s],e[n]]=[e[n],e[s]]}return e}}const xt=["Axt","Doppelaxt","Wurfklinge","Speer","Kriegstrommel"],bt=["Leder","Ketten","Schuppen","Schädelplatten"],It=["Blutring","Schlackenfetisch","Königszahn","Sturmsiegel"],Mt=["Axt","Wurfklinge","Bogen","Streitkolben","Schamane"];function _(t){return Math.max(0,Math.min(1,t))}function Lt(t){return`${t.pick(at)}${t.pick(lt)}`}function Rt(t){return{aggression:_(t.next()),loyalty:_(t.next()),opportunism:_(t.next()),ambition:_(t.next())}}function kt(t){const i=t.chance(.3)?2:1;return t.shuffle(rt).slice(0,i)}function vt(t){const i=t.shuffle(Mt),e=t.chance(.25)?2:1;return i.slice(0,e)}function wt(t){const i=t.chance(.5)?t.pick(It):void 0;return{weapon:t.pick(xt),armor:t.pick(bt),trinket:i}}function Ct(t){switch(t){case"Grunzer":return 10;case"Späher":return 40;case"Captain":return 80;case"Anführer":return 140;case"Herausforderer":return 210;case"König":return 320}}function Bt(t){return t.chance(.3)?[t.pick(ct)]:[]}function V(t,i={}){const e=i.rank??"Grunzer",s=i.id??`orc_${Math.round(t.next()*1e9)}`,n=i.equipment??wt(t),r=i.level??t.int(e==="König"?8:1,e==="König"?12:6),o=i.merit??Math.max(0,Math.round(Ct(e)+t.int(-15,20)));return{id:s,name:i.name??Lt(t),clan:i.clan??t.pick(ot),titles:i.titles??Bt(t),level:r,rank:e,merit:o,combatStyle:i.combatStyle??vt(t),traits:i.traits??kt(t),equipment:n,gearScore:i.gearScore??t.int(8,16),status:i.status??"ALIVE",personality:i.personality??Rt(t),relationships:i.relationships??{friends:[],rivals:[],loyalToKing:!1},memories:i.memories??[],territory:i.territory??[t.pick(j)],lastBloodOathCycle:i.lastBloodOathCycle}}function G(t,i,e=12){const s=[...t.memories,i].slice(-e);return{...t,memories:s}}function Wt(t,i){return{...t,merit:Math.max(0,t.merit+i)}}function ge(t){return{...t,status:"DEAD"}}function Pt(t,i){return t.relationships.bloodOathWith?t.lastBloodOathCycle!==void 0&&i-t.lastBloodOathCycle<=tt:!1}class Nt{constructor(i,e){this.rng=i,this.state=e}getAlive(){return this.state.officers.filter(i=>i.status==="ALIVE")}getById(i){return this.state.officers.find(e=>e.id===i)}registerDeath(i,e){const s=[],n=[],r=this.state.officers.map(a=>a.id!==i?a:(s.push({officerId:i,status:"DEAD",reason:"BATTLE"}),n.push({id:`death_${i}_${e}`,cycle:e,text:`${a.name} fällt im Kampf`,tags:["DEATH"]}),ge(a))),o=r.find(a=>a.id===i);if(o&&o.relationships.bloodOathWith){const a=o.relationships.bloodOathWith,c=r.findIndex(l=>l.id===a);if(c>=0){const l=r[c];l.status==="ALIVE"&&Pt(l,e)&&(s.push({officerId:l.id,status:"DEAD",reason:"BLOOD_OATH"}),n.push({id:`blood_${l.id}_${e}`,cycle:e,text:`${l.name} stirbt durch den Blutschwur mit ${o.name}`,tags:["DEATH","BLOODOATH"]}),r[c]=ge(l))}}return this.state.officers=r,{updatedOfficers:r,casualties:s,feed:n}}rewardMerit(i,e,s,n){this.state.officers=this.state.officers.map(r=>{if(r.id!==i)return r;const o=Wt(r,e);return G(o,{cycle:s,type:"WARCALL",notes:n})})}ensureRoster(i){const e=[];for(;this.getAlive().length<Oe;){const s=V(this.rng,{rank:"Grunzer"}),n=G(s,{cycle:i,type:"WARCALL",notes:"Frisch rekrutiert"});e.push(n),this.state.officers.push(n)}return e}registerBloodOath(i,e,s){this.state.officers=this.state.officers.map(n=>n.id===i?{...n,relationships:{...n.relationships,bloodOathWith:e},lastBloodOathCycle:s}:n.id===e?{...n,relationships:{...n.relationships,bloodOathWith:i},lastBloodOathCycle:s}:n)}detectCycleTrigger(i){return this.getAlive().length<i?"OFFICER_DEATH":null}}function W(t,i){const e=M(t),s=.9+i.next()*.2;return e*s}function Dt(t,i,e){let s=.05+i.personality.opportunism*.25-i.personality.loyalty*.2;return i.relationships.rivals.includes(e.id)&&(s+=.15),i.relationships.bloodOathWith===e.id&&(s=0),s>0&&t.chance(Math.min(.8,Math.max(0,s)))}function O(t,i,e,s){return{id:`feed_${i}_${Math.round(t.next()*1e9)}`,cycle:i,text:e,tags:s}}function Ft(t,i){return i.map(e=>t.getById(e)).filter(e=>!!(e&&e.status==="ALIVE"))}function U(t,i,e,s,n){i.forEach(r=>t.rewardMerit(r.id,s,e,n))}function L(t,i,e){const{casualties:s,feed:n}=t.registerDeath(i.id,e);return{casualties:s,feed:n}}function Te(t,i,e,s,n,r,o){const a=[];if(W(n,t)>=r){U(s,n,e.cycle,i.rewards.merit,o);const u=O(t,e.cycle,`${n[0].name}s Gruppe triumphiert bei ${i.location}`,[i.type,"SUCCESS"]);return a.push(u),{warcall:i,victorious:n.map(y=>y.id),defeated:[],betrayals:[],casualties:[],feedEntries:a}}const l=t.pick(n),h=L(s,l,e.cycle);return a.push(O(t,e.cycle,`${l.name} kehrt nicht von ${i.location} zurück`,[i.type,"DEATH"])),{warcall:i,victorious:[],defeated:[l.id],betrayals:[],casualties:h.casualties,feedEntries:[...a,...h.feed]}}function $t(t,i,e,s,n){const r=[],o=i.hiddenRoles.find(y=>y.role==="ASSASSIN"),a=o?n.find(y=>y.id===o.who):n[0],c=n.find(y=>y.id!==(a==null?void 0:a.id));if(!a||!c)return r.push(O(t,e.cycle,`Attentat ${i.id} scheitert mangels Opfer`,["ASSASSINATION","ABORTED"])),{warcall:i,victorious:[],defeated:[],betrayals:[],casualties:[],feedEntries:r};const l=B(a,[a]),h=B(c,[c]),u=(t.next()-.5)*4;if(l+u>h){const y=L(s,c,e.cycle);return s.rewardMerit(a.id,i.rewards.merit,e.cycle,"Gelungenes Attentat"),r.push(O(t,e.cycle,`${a.name} meuchelt ${c.name} in ${i.location}`,["ASSASSINATION","SUCCESS"])),{warcall:i,victorious:[a.id],defeated:[c.id],betrayals:[],casualties:y.casualties,feedEntries:[...r,...y.feed]}}if(t.chance(.5)){const y=L(s,a,e.cycle);return r.push(O(t,e.cycle,`${a.name} stirbt beim gescheiterten Attentat auf ${c.name}`,["ASSASSINATION","DEATH"])),{warcall:i,victorious:[c.id],defeated:[a.id],betrayals:[],casualties:y.casualties,feedEntries:[...r,...y.feed]}}return r.push(O(t,e.cycle,`${c.name} wehrt ${a.name}s Angriff ab`,["ASSASSINATION","FAIL"])),{warcall:i,victorious:[c.id],defeated:[],betrayals:[],casualties:[],feedEntries:r}}function Ht(t,i,e,s,n){const r=[],o=n.find(m=>m.id===i.initiator);if(!o)return r.push(O(t,e.cycle,`Überfall ${i.id} scheitert ohne Initiator`,["OVERFALL","ABORTED"])),{warcall:i,victorious:[],defeated:[],betrayals:[],casualties:[],feedEntries:r};const a=n.filter(m=>m.id!==o.id);if(a.length===0)return r.push(O(t,e.cycle,`${o.name} findet keine Gegner für den Überfall`,["OVERFALL","ABORTED"])),{warcall:i,victorious:[],defeated:[],betrayals:[],casualties:[],feedEntries:r};const c=Math.max(1,Math.floor(a.length/2)),l=[o,...a.slice(0,c)],h=a.slice(c);if(h.length===0)return r.push(O(t,e.cycle,`${o.name} vertreibt Plünderer ohne Widerstand`,["OVERFALL","NO_DEF"])),U(s,l,e.cycle,Math.round(i.rewards.merit/2),"Leichter Überfall"),{warcall:i,victorious:l.map(m=>m.id),defeated:[],betrayals:[],casualties:[],feedEntries:r};const u=[];for(const m of l.slice(1))Dt(t,m,o)&&(h.push(m),l.splice(l.indexOf(m),1),u.push(m.id));const y=W(l,t),S=W(h,t),g=y>=S,T=g?h:l,p=g?l:h;U(s,p,e.cycle,i.rewards.merit,"Überfall-Erfolg");const A=t.pick(T),E=L(s,A,e.cycle);return r.push(O(t,e.cycle,`${p[0].name}s Seite siegt bei ${i.location}`,["OVERFALL",g?"SUCCESS":"FAIL"])),{warcall:i,victorious:p.map(m=>m.id),defeated:T.map(m=>m.id),betrayals:u,casualties:E.casualties,feedEntries:[...r,...E.feed]}}function _t(t,i,e,s,n){const r=[],o=n.find(m=>m.id===i.initiator);if(!o)return r.push(O(t,e.cycle,`Säuberung ${i.id} scheitert ohne König`,["PURGE","ABORTED"])),{warcall:i,victorious:[],defeated:[],betrayals:[],casualties:[],feedEntries:r};const a=n.filter(m=>m.id===o.id||i.hiddenRoles.some(P=>P.who===m.id&&P.role==="LOYALIST")),c=n.filter(m=>!a.includes(m));if(c.length===0)return r.push(O(t,e.cycle,`${o.name} erzwingt neue Treueschwüre`,["PURGE","LOYALTY"])),U(s,a,e.cycle,Math.round(i.rewards.merit/2),"Treueeid"),{warcall:i,victorious:a.map(m=>m.id),defeated:[],betrayals:[],casualties:[],feedEntries:r};const l=c.filter(m=>t.chance(.4)),h=c.filter(m=>!l.includes(m)),u=h.map(m=>m.id);if(h.length===0)return r.push(O(t,e.cycle,`${o.name} erklärt ${l.length} Offiziere zu Vogelfreien`,["PURGE","EXILE"])),{warcall:i,victorious:a.map(m=>m.id),defeated:l.map(m=>m.id),betrayals:u,casualties:[],feedEntries:r};const y=W(a,t),S=W(h,t),g=y>=S,T=g?h:a,p=g?a:h,A=t.pick(T),E=L(s,A,e.cycle);return r.push(O(t,e.cycle,`${p[0].name} entscheidet die Säuberung`,["PURGE",g?"SUCCESS":"REBELLION"])),{warcall:i,victorious:p.map(m=>m.id),defeated:T.map(m=>m.id),betrayals:u,casualties:E.casualties,feedEntries:[...r,...E.feed]}}function zt(t,i,e,s,n){const r=[];n.forEach(a=>s.rewardMerit(a.id,Math.round(i.rewards.merit/2),e.cycle,"Feast-Bindung"));const o=O(t,e.cycle,`${n[0].name} richtet ein heikles Festmahl in ${i.location}`,["FEAST","BOND"]);if(r.push(o),n.length>1&&t.chance(.15)){const a=t.pick(n.slice(1)),c=t.pick(n.filter(h=>h.id!==a.id)),l=L(s,c,e.cycle);return r.push(O(t,e.cycle,`${a.name} vergiftet ${c.name} beim Fest`,["FEAST","BETRAYAL"])),{warcall:i,victorious:[a.id],defeated:[c.id],betrayals:[a.id],casualties:l.casualties,feedEntries:[...r,...l.feed]}}return{warcall:i,victorious:n.map(a=>a.id),defeated:[],betrayals:[],casualties:[],feedEntries:r}}function Vt(t,i,e,s){const n=Ft(s,i.participants);if(n.length===0)return{warcall:i,victorious:[],defeated:[],betrayals:[],casualties:[],feedEntries:[O(t,e.cycle,`Warcall ${i.id} entfällt mangels Teilnehmer`,["EMPTY"])]};switch(i.type){case"HUNT":return Te(t,i,e,s,n,16,"Erfolgreiche Jagd");case"MONSTER_HUNT":return Te(t,i,e,s,n,26,"Monster bezwungen");case"ASSASSINATION":return $t(t,i,e,s,n);case"OVERFALL":return Ht(t,i,e,s,n);case"PURGE":return _t(t,i,e,s,n);case"FEAST":default:return zt(t,i,e,s,n)}}function ie(t,i){return`wc_${t.cycle}_${t.warcalls.length}_${Math.round(i.next()*1e6)}`}function Gt(t){const i=t.next();return i<.5?"AGENDA":i<.8?"RANDOM":"PLAYER"}function Ut(t){return t.personality.aggression>.7?"OVERFALL":t.personality.opportunism>.6?"ASSASSINATION":t.rank==="König"?"PURGE":"FEAST"}function Kt(t){return t.pick(["HUNT","MONSTER_HUNT","FEAST","OVERFALL"])}function se(t,i,e,s,n){const r=i.officers.filter(h=>h.status==="ALIVE"&&h.id!==e.id),o=t.shuffle(r);if(o.length===0)return[e];const a=Math.max(1,Math.min(s,o.length)),c=t.int(1,a),l=o.slice(0,c);if(n){const h=i.officers.find(u=>u.id===i.playerId&&u.status==="ALIVE");h&&!l.some(u=>u.id===h.id)&&h.id!==e.id&&(l[l.length-1]=h)}return[e,...l]}function ne(t,i,e){return i==="ASSASSINATION"?[{who:t.pick(e).id,role:"ASSASSIN"}]:i==="PURGE"?e.slice(1).map(s=>({who:s.id,role:t.chance(.5)?"LOYALIST":"TRAITOR"})):[]}function re(t){switch(t){case"FEAST":return{xp:10,merit:8,titles:[]};case"OVERFALL":return{xp:30,merit:20,titles:[]};case"ASSASSINATION":return{xp:35,merit:28,titles:[]};case"HUNT":return{xp:18,merit:14,titles:[]};case"MONSTER_HUNT":return{xp:45,merit:30,titles:["Bestienjäger"]};case"PURGE":return{xp:50,merit:35,titles:[]}}}function Yt(t,i,e){const s=Ut(e),n=se(t,i,e,s==="PURGE"?5:3,!1);return{id:ie(i,t),type:s,source:"AGENDA",initiator:e.id,participants:n.map(r=>r.id),hiddenRoles:ne(t,s,n),location:t.pick(j),startCycle:i.cycle,deadlineCycle:i.cycle+1,rewards:re(s),state:"ANNOUNCED"}}function jt(t,i){const e=i.officers.filter(o=>o.status==="ALIVE"),s=t.pick(e),n=Kt(t),r=se(t,i,s,3,!1);return{id:ie(i,t),type:n,source:"RANDOM",initiator:s.id,participants:r.map(o=>o.id),hiddenRoles:ne(t,n,r),location:t.pick(j),startCycle:i.cycle,deadlineCycle:i.cycle+1,rewards:re(n),state:"ANNOUNCED"}}function Xt(t,i){const e=i.officers.find(r=>r.id===i.playerId&&r.status==="ALIVE");if(!e)return null;const s=e.rank==="Grunzer"?"HUNT":"OVERFALL",n=se(t,i,e,2,!0);return{id:ie(i,t),type:s,source:"PLAYER",initiator:e.id,participants:n.map(r=>r.id),hiddenRoles:ne(t,s,n),location:t.pick(j),startCycle:i.cycle,deadlineCycle:i.cycle+1,rewards:re(s),state:"ANNOUNCED"}}function qt(t,i){const e=i.warcalls.filter(o=>o.state!=="RESOLVED"),s=t.int(Qe,et),n=Math.max(0,s-e.length),r=[];for(let o=0;o<n;o++){const a=Gt(t),c=i.officers.filter(h=>h.status==="ALIVE");if(c.length<2)break;let l=null;if(a==="AGENDA"){const h=[...c].sort((u,y)=>y.personality.ambition-u.personality.ambition);l=Yt(t,i,h[0])}else a==="RANDOM"?l=jt(t,i):l=Xt(t,i);l&&(r.push(l),i.warcalls.push(l))}return r}function Zt(t,i,e){const s=[];for(const n of i.warcalls){if(n.state==="RESOLVED"||i.cycle<n.deadlineCycle)continue;n.state="IN_PROGRESS";const r=Vt(t,n,i,e);n.state="RESOLVED",s.push(r)}return s}const C=["Grunzer","Späher","Captain","Anführer","Herausforderer","König"];function Jt(t){const i=C.indexOf(t);return i===-1||i>=C.length-1?null:C[i+1]}function Qt(t){const i=C.indexOf(t);return i<=0?null:C[i-1]}function K(t,i,e,s){return{id:`cycle_${i}_${Math.round(t.next()*1e9)}`,cycle:i,text:e,tags:s}}function ei(t,i){const e=[],s=[];return i.officers=i.officers.map(n=>{if(n.status!=="ALIVE")return n;const r=it[n.rank],o=r.promoteAtMerit!==null&&n.merit>=r.promoteAtMerit?Jt(n.rank):null;if(o)return e.push({officerId:n.id,from:n.rank,to:o}),s.push(K(t,i.cycle,`${n.name} steigt zum ${o} auf`,["PROMOTION"])),G({...n,rank:o},{cycle:i.cycle,type:"PROMOTION",notes:`Aufstieg zu ${o}`});const a=r.demoteBelowMerit!==null&&n.merit<r.demoteBelowMerit?Qt(n.rank):null;return a?(e.push({officerId:n.id,from:n.rank,to:a}),s.push(K(t,i.cycle,`${n.name} fällt zum ${a} zurück`,["DEMOTION"])),G({...n,rank:a},{cycle:i.cycle,type:"DEMOTION",notes:`Rückstufung zu ${a}`})):n}),{changes:e,feed:s}}function ti(t){return t.flatMap(i=>i.feedEntries)}function ii(t,i,e="DEBUG"){const s=new Nt(t,i),n=s.getAlive().length;i.cycle+=1;const r=Zt(t,i,s),o=ei(t,i),a=s.ensureRoster(i.cycle),c=qt(t,i),l=[];l.push(...ti(r)),l.push(...o.feed),a.forEach(y=>{l.push(K(t,i.cycle,`${y.name} tritt als Rekrut bei`,["RECRUIT"]))}),c.forEach(y=>{l.push(K(t,i.cycle,`Neuer Warcall ${y.type} bei ${y.location}`,["WARCALL","NEW"]))}),i.feed=[...i.feed,...l].slice(-60);const u=s.detectCycleTrigger(n)??e;return{cycle:i.cycle,trigger:u,newWarcalls:c,resolved:r,hierarchyChanges:o.changes,replacements:a,feed:l}}function si(t){return Array.from({length:Oe},(e,s)=>s===0?V(t,{rank:"König",titles:["König"],relationships:{friends:[],rivals:[],loyalToKing:!0}}):s===1?V(t,{rank:"Grunzer",titles:[],relationships:{friends:[],rivals:[],loyalToKing:!1}}):V(t,{}))}class Ae{constructor(i){d(this,"state");d(this,"rng");this.rng=new Et(i.seed);const e=si(this.rng),s=e[0].id,n=e[1].id;this.state={cycle:0,officers:e,warcalls:[],kingId:s,playerId:n,feed:[]}}runCycle(i="DEBUG"){return ii(this.rng,this.state,i)}}const b=Y(),ni=128,ri=140,oi=.65,ai={WARCALL_COMPLETED:"Warcall abgeschlossen",FREE_ROAM_TIMEOUT:"Freies Spiel (Timeout)",OFFICER_DEATH:"Offizier gefallen",DEBUG:"Debug"};function li(t){const i=t.split(" ")[0]??t;return i.length>10?`${i.slice(0,9)}…`:i}class ci extends b.Scene{constructor(){super("Play");d(this,"world");d(this,"officerTokens",new Map);d(this,"cycleText");d(this,"triggerText");d(this,"feedLabel");d(this,"feedText");d(this,"warcallLabel");d(this,"warcallsText");d(this,"detailLabel");d(this,"detailText");d(this,"controlsText");d(this,"boardBg");d(this,"sidebarBg");d(this,"connections");d(this,"cemeteryButton");d(this,"cemeteryButtonBg");d(this,"cemeteryLabel");d(this,"cemeteryCount");d(this,"cemeteryOverlay");d(this,"cemeteryScrim");d(this,"cemeteryOverlayBg");d(this,"cemeteryOverlayTitle");d(this,"cemeteryListContainer");d(this,"cemeteryOverlayList");d(this,"cemeteryListMaskShape");d(this,"cemeteryMask");d(this,"cemeteryScrollArea");d(this,"cemeteryOverlayClose");d(this,"warcallIconBar");d(this,"warcallIconBarBg");d(this,"warcallIcons",new Map);d(this,"warcallIconMeta",new Map);d(this,"boardArea",{x:120,y:120,width:620,height:500});d(this,"sidebarArea",{x:660,y:36,width:280,height:520});d(this,"sidebarPadding",24);d(this,"highlightIds",new Set);d(this,"focusedWarcallId",null);d(this,"focusRoles",new Map);d(this,"detailMode","DEFAULT");d(this,"lastSummary");d(this,"defaultDetailMessage","Fahre mit der Maus über ein Porträt oder tippe es an.");d(this,"portraitKeys",[]);d(this,"officerPortraitMap",new Map);d(this,"cemeteryScroll",0);d(this,"cemeteryListX",0);d(this,"cemeteryListY",0);d(this,"cemeteryViewportHeight",0);d(this,"cemeteryListWidth",0);d(this,"cemeteryContentHeight",0)}create(){this.world=new Ae({seed:Date.now()}),this.portraitKeys=J(this),this.officerPortraitMap.clear(),this.boardBg=this.add.rectangle(0,0,10,10,1054496,.92).setOrigin(0,0),this.boardBg.setStrokeStyle(2,2568767,.85),this.boardBg.setInteractive({useHandCursor:!1}),this.boardBg.on("pointerdown",()=>{this.clearWarcallSelection()}),this.sidebarBg=this.add.rectangle(0,0,10,10,857114,.92).setOrigin(0,0),this.sidebarBg.setStrokeStyle(1,2041907,.6),this.connections=this.add.graphics(),this.connections.setDepth(.5),this.cycleText=this.add.text(0,0,"",{fontFamily:"monospace",fontSize:"22px",color:"#f1f2f6"}),this.triggerText=this.add.text(0,0,"",{fontFamily:"monospace",fontSize:"14px",color:"#cbd0d6"}),this.feedLabel=this.add.text(0,0,"Welt-Feed",{fontFamily:"monospace",fontSize:"16px",color:"#f1f2f6"}),this.feedText=this.add.text(0,0,"",{fontFamily:"monospace",fontSize:"12px",color:"#d1d9e6",lineSpacing:6}).setWordWrapWidth(240),this.warcallLabel=this.add.text(0,0,"Aktive Warcalls",{fontFamily:"monospace",fontSize:"16px",color:"#f1f2f6"}),this.warcallsText=this.add.text(0,0,"",{fontFamily:"monospace",fontSize:"12px",color:"#d1d9e6",lineSpacing:6}).setWordWrapWidth(240),this.detailLabel=this.add.text(0,0,"Details",{fontFamily:"monospace",fontSize:"16px",color:"#f1f2f6"}),this.detailText=this.add.text(0,0,this.defaultDetailMessage,{fontFamily:"monospace",fontSize:"12px",color:"#d1d9e6",lineSpacing:4}).setWordWrapWidth(240),this.controlsText=this.add.text(0,0,"E: Cycle simulieren   R: Welt neu generieren",{fontFamily:"monospace",fontSize:"12px",color:"#9da3ae"}),this.initializeWarcallIconBar(),this.initializeCemeteryUI(),this.scale.on(b.Scale.Events.RESIZE,this.configureLayout,this),this.configureLayout(),this.refreshScene(),this.input.keyboard.on("keydown-E",()=>this.advanceCycle()),this.input.keyboard.on("keydown-R",()=>this.resetWorld()),this.events.once(b.Scenes.Events.SHUTDOWN,()=>{this.officerTokens.forEach(e=>e.destroy()),this.officerTokens.clear(),this.warcallIcons.forEach(e=>e.destroy(!0)),this.warcallIcons.clear(),this.warcallIconMeta.clear(),this.scale.off(b.Scale.Events.RESIZE,this.configureLayout,this),this.boardBg.off("pointerdown")})}update(e,s){}advanceCycle(){const e=this.world.runCycle();this.refreshScene(e)}resetWorld(){this.officerTokens.forEach(e=>e.destroy()),this.officerTokens.clear(),this.warcallIcons.forEach(e=>e.destroy(!0)),this.warcallIcons.clear(),this.warcallIconMeta.clear(),this.focusRoles.clear(),this.focusedWarcallId=null,this.showDefaultDetails(),this.hideCemeteryOverlay(),this.officerPortraitMap.clear(),this.portraitKeys=J(this),this.cemeteryScroll=0,this.world=new Ae({seed:Date.now()}),this.refreshScene()}refreshScene(e){this.lastSummary=e,this.highlightIds=$e(e),this.validateWarcallFocus(),this.cycleText.setText(`Cycle ${this.world.state.cycle}`);const s=e?this.formatTrigger(e.trigger):"Start der Kampagne";this.triggerText.setText(`Auslöser: ${s}`),this.syncOfficerTokens(e),this.refreshFeed(e),this.refreshWarcalls(e),this.drawConnections(e),this.syncWarcallIcons(e),this.updateCemeteryUI(),this.updateSidebarFlow()}formatTrigger(e){return ai[e]??e}syncOfficerTokens(e){const s=new Set(this.highlightIds),n=this.world.state.officers.filter(u=>u.status==="ALIVE"),r=n.length,o=le(this.boardArea,r),a=ce(r,o),c=this.computeTokenScale(o),l=new Set,h=!e;n.forEach((u,y)=>{const S=a[y],g=s.has(u.id),T=this.focusRoles.get(u.id)??null,p=this.getPortraitKey(u);let A=this.officerTokens.get(u.id);A?A.setPosition(S.x,S.y,{immediate:h}):(A=new Ce({scene:this,x:S.x,y:S.y,officer:u,portraitKey:p,scale:c,highlight:g,onHover:E=>this.showOfficerDetails(E),onBlur:()=>this.clearOfficerDetails()}),this.officerTokens.set(u.id,A)),A.update(u,{highlight:g,focus:T,scale:c}),l.add(u.id)}),this.officerTokens.forEach((u,y)=>{l.has(y)||(u.destroy(),this.officerTokens.delete(y))})}refreshFeed(e){const s=new Set((e==null?void 0:e.feed.map(o=>o.id))??[]),n=this.world.state.feed.slice(-6);if(n.length===0){this.feedText.setText("Keine Meldungen – starte einen Warcall!");return}const r=n.map(o=>`${s.has(o.id)?"»":"•"} [${o.cycle}] ${o.text}`);this.feedText.setText(r.join(`

`))}refreshWarcalls(e){const s=this.world.state.warcalls.filter(o=>o.state!=="RESOLVED");if(s.length===0){this.warcallsText.setText("Keine aktiven Warcalls.");return}const n=new Set((e==null?void 0:e.newWarcalls.map(o=>o.id))??[]),r=s.map(o=>this.describeWarcall(o,n.has(o.id)));this.warcallsText.setText(r.join(`

`))}describeWarcall(e,s){const r=this.focusedWarcallId===e.id?"★":s?"»":"•",o=v[e.type],a=w[e.type],c=this.collectParticipantIds(e).map(h=>this.getOfficerShortName(h)).join(", "),l=Math.round(this.computeWarcallSuccess(e)*100);return`${r} ${o} ${a} @ ${e.location}
   Erfolg: ${l}% für ${this.getOfficerShortName(e.initiator)}
   ${c}`}drawConnections(e){this.connections.clear();const s=(r,o,a,c)=>{const l=this.officerTokens.get(r.initiator);if(!l)return;const h=l.getPosition();r.participants.forEach(u=>{const y=this.officerTokens.get(u);if(!y)return;const S=y.getPosition();this.connections.lineStyle(c,o,a),this.connections.strokeLineShape(new b.Geom.Line(h.x,h.y,S.x,S.y))})};if(this.world.state.warcalls.filter(r=>r.state!=="RESOLVED").forEach(r=>s(r,5032432,.35,2)),e&&(e.newWarcalls.forEach(r=>s(r,16170336,.65,3)),e.resolved.forEach(r=>s(r.warcall,15681391,.55,3))),this.focusedWarcallId){const r=this.world.state.warcalls.find(o=>o.id===this.focusedWarcallId&&o.state!=="RESOLVED");r&&s(r,16170336,.9,4)}}configureLayout(){const e=Math.max(this.scale.gameSize.width,1),s=Math.max(this.scale.gameSize.height,1),n=Math.max(24,Math.round(Math.min(e,s)*.04));this.cycleText.setPosition(n,n),this.triggerText.setPosition(n,n+28),this.controlsText.setPosition(n,s-n-this.controlsText.height);const r=Math.max(e-n*3,0);let o=Math.min(Math.max(r*.64,0),r),a=r-o;if(r>0){const H=Math.min(Math.max(220,r*.28),r);a<H&&(a=H,o=r-a);const oe=Math.min(Math.max(320,r*.55),r);o<oe&&(o=oe,a=r-o)}const c=n+72,l=this.controlsText.y,h=Math.max(c+220,l-16);let u=Math.max(320,h-c);u>h-c&&(u=h-c);const y=n,S=Math.max(c,h-u);this.boardBg.setPosition(y,S),this.boardBg.setDisplaySize(o,u);const g=y+o+n,T=Math.max(200,s-n*2);this.sidebarBg.setPosition(g,n),this.sidebarBg.setDisplaySize(a,T);let p=Math.min(110,Math.max(72,Math.round(u*.22))),A=u-p-32;if(A<180){const H=180-A;p=Math.max(60,p-H),A=u-p-32}A<160&&(A=Math.max(140,Math.round(u*.65)),p=Math.max(60,u-A-20));const E=S+u-p;this.warcallIconBar.setPosition(y,E),this.warcallIconBarBg.setDisplaySize(o,p),this.layoutWarcallIcons(),this.boardArea={x:y,y:S,width:o,height:Math.max(160,A)},this.sidebarArea={x:g,y:n,width:a,height:T},this.sidebarPadding=Math.max(20,Math.round(a*.08));const m=this.cemeteryButtonBg.displayWidth,P=this.cemeteryButtonBg.displayHeight;let X=S-P-12;X<n&&(X=S+12);const xe=y+o-m-16;this.cemeteryButton.setPosition(xe,X),this.cemeteryScrim.setDisplaySize(e,s);const q=Math.min(Math.max(320,o*.7),Math.max(320,e-n*2)),N=Math.min(Math.max(280,u*.8),Math.max(260,s-n*2));this.cemeteryOverlayBg.setDisplaySize(q,N),this.cemeteryOverlayBg.setPosition(e/2,s/2),this.cemeteryOverlayTitle.setPosition(e/2,s/2-N/2+24);const D=e/2-q/2+24,F=this.cemeteryOverlayTitle.y+this.cemeteryOverlayTitle.height+16,R=q-48,$=Math.max(140,N-128);this.cemeteryListX=D,this.cemeteryListY=F,this.cemeteryListWidth=R,this.cemeteryViewportHeight=$,this.cemeteryOverlayList.setWordWrapWidth(R),this.cemeteryListContainer.setPosition(D,F-this.cemeteryScroll),this.cemeteryListMaskShape.setPosition(D,F),this.cemeteryListMaskShape.clear(),this.cemeteryListMaskShape.fillStyle(16777215,1),this.cemeteryListMaskShape.fillRect(0,0,R,$),this.cemeteryScrollArea.setPosition(D,F),this.cemeteryScrollArea.setSize(R,$),this.cemeteryScrollArea.displayWidth=R,this.cemeteryScrollArea.displayHeight=$,this.refreshCemeteryScrollBounds(),this.cemeteryOverlayClose.setPosition(e/2,s/2+N/2-28),this.reflowOfficerPositions(),this.drawConnections(),this.updateSidebarFlow(),this.layoutWarcallIcons()}reflowOfficerPositions(){if(!this.world||this.officerTokens.size===0)return;const e=this.world.state.officers.filter(a=>a.status==="ALIVE"),s=e.length,n=le(this.boardArea,s),r=ce(s,n),o=this.computeTokenScale(n);e.forEach((a,c)=>{const l=this.officerTokens.get(a.id);l&&(l.setPosition(r[c].x,r[c].y,{immediate:!0}),l.setScale(o))})}updateSidebarFlow(){if(this.sidebarArea.width<=0||this.sidebarArea.height<=0)return;const e=this.sidebarArea.x+this.sidebarPadding,s=this.sidebarArea.y+this.sidebarPadding,n=Math.max(160,this.sidebarArea.width-this.sidebarPadding*2);this.feedLabel.setPosition(e,s),this.feedText.setPosition(e,this.feedLabel.y+this.feedLabel.height+6),this.feedText.setWordWrapWidth(n);let o=this.feedText.getBounds().bottom+24;this.warcallLabel.setPosition(e,o),this.warcallsText.setPosition(e,this.warcallLabel.y+this.warcallLabel.height+6),this.warcallsText.setWordWrapWidth(n),o=this.warcallsText.getBounds().bottom+24;const c=this.sidebarArea.y+this.sidebarArea.height-this.sidebarPadding;o+this.detailLabel.height+6>c&&(o=Math.max(s,c-(this.detailLabel.height+6))),this.detailLabel.setPosition(e,o);const l=this.detailLabel.y+this.detailLabel.height+6;this.detailText.setPosition(e,l);const h=Math.max(0,c-l);this.detailText.setWordWrapWidth(n),this.detailText.setFixedSize(n,h)}showOfficerDetails(e){this.detailMode="OFFICER",this.detailLabel.setText("Details – Offizier");const s=e.traits.length>0?e.traits.join(", "):"Keine bekannten Traits",n=e.relationships.bloodOathWith?this.getOfficerShortName(e.relationships.bloodOathWith):"Kein",r=e.relationships.loyalToKing?"Ja":"Nein",o=this.formatOfficerNames(e.relationships.friends),a=this.formatOfficerNames(e.relationships.rivals),c=this.world.state.warcalls.filter(S=>S.state!=="RESOLVED"),l=Fe(e,c,S=>this.getOfficerById(S)),h=l.warcallId?this.world.state.warcalls.find(S=>S.id===l.warcallId):void 0,u=h?`${v[h.type]} `:"",y=[`${e.name} (${e.rank}, Lv ${e.level})`,`Clan ${e.clan} • Merit gesamt ${Math.round(e.merit)}`,`Traits: ${s}`,`Verbündete: ${o}`,`Rivalen: ${a}`,`Blutschwur: ${n}`,`Loyal zum König: ${r}`,`Aktivität: ${u}${l.summary}`];this.detailText.setText(y.join(`
`))}clearOfficerDetails(){this.detailMode==="OFFICER"&&this.showDefaultDetails()}showDefaultDetails(){this.detailMode="DEFAULT",this.detailLabel.setText("Details"),this.detailText.setText(this.defaultDetailMessage)}getOfficerById(e){return this.world.state.officers.find(s=>s.id===e)}formatOfficerNames(e){return e.length===0?"Keine":e.map(s=>this.getOfficerShortName(s)).join(", ")}getPortraitKey(e){this.portraitKeys.length===0&&(this.portraitKeys=J(this));let s=this.officerPortraitMap.get(e.id);if(s)return s;const n=Je(e.id)%this.portraitKeys.length,r=new Set;this.officerPortraitMap.forEach(c=>{const l=this.portraitKeys.indexOf(c);l>=0&&r.add(l)});let o=n,a=0;for(;a<this.portraitKeys.length&&r.has(o);)o=(o+7)%this.portraitKeys.length,a+=1;return s=this.portraitKeys[o]??this.portraitKeys[n]??this.portraitKeys[0],s||(s=`officer-portrait-${o%this.portraitKeys.length}`),this.officerPortraitMap.set(e.id,s),s}computeTokenScale(e){const s=e.cellWidth/ni,n=e.cellHeight/ri,r=Math.min(1,s,n);return Math.max(oi,Math.min(1.15,r))}computeWarcallSuccess(e){const s=Ot(this.world.state,e);return Number.isFinite(s)?Math.min(1,Math.max(0,s)):0}initializeWarcallIconBar(){this.warcallIconBar=this.add.container(0,0),this.warcallIconBar.setDepth(1.2),this.warcallIconBarBg=this.add.rectangle(0,0,120,80,725272,.88).setOrigin(0,0),this.warcallIconBarBg.setStrokeStyle(1,2041907,.6),this.warcallIconBarBg.setInteractive({useHandCursor:!1}),this.warcallIconBarBg.on("pointerdown",e=>{var s;(s=e.event)==null||s.stopPropagation(),this.clearWarcallSelection()}),this.warcallIconBar.add(this.warcallIconBarBg)}initializeCemeteryUI(){this.cemeteryButton=this.add.container(0,0),this.cemeteryButtonBg=this.add.rectangle(0,0,160,36,1318955,.9).setOrigin(0,0),this.cemeteryButtonBg.setStrokeStyle(1,2568767,.9),this.cemeteryLabel=this.add.text(14,36/2,"Friedhof",{fontFamily:"monospace",fontSize:"13px",color:"#f1f2f6"}).setOrigin(0,.5),this.cemeteryCount=this.add.text(144,36/2,"(0)",{fontFamily:"monospace",fontSize:"12px",color:"#d1d9e6"}).setOrigin(1,.5),this.cemeteryButton.add([this.cemeteryButtonBg,this.cemeteryLabel,this.cemeteryCount]),this.cemeteryButton.setDepth(1.4),this.cemeteryButton.setSize(160,36),this.cemeteryButton.setInteractive(new b.Geom.Rectangle(0,0,160,36),b.Geom.Rectangle.Contains),this.cemeteryButton.on("pointerover",()=>{this.input.setDefaultCursor("pointer"),this.cemeteryButtonBg.setStrokeStyle(1,16170336,.9)}),this.cemeteryButton.on("pointerout",()=>{this.input.setDefaultCursor("default"),this.cemeteryButtonBg.setStrokeStyle(1,2568767,.9)}),this.cemeteryButton.on("pointerdown",()=>{this.toggleCemeteryOverlay()}),this.cemeteryOverlay=this.add.container(0,0),this.cemeteryScrim=this.add.rectangle(0,0,10,10,330513,.6).setOrigin(0,0),this.cemeteryScrim.setInteractive({useHandCursor:!1}),this.cemeteryScrim.on("pointerdown",()=>this.hideCemeteryOverlay()),this.cemeteryOverlayBg=this.add.rectangle(0,0,360,420,857114,.95).setOrigin(.5),this.cemeteryOverlayBg.setStrokeStyle(1,2041907,.8),this.cemeteryOverlayBg.setInteractive({useHandCursor:!1}),this.cemeteryOverlayBg.on("pointerdown",n=>{var r;return(r=n.event)==null?void 0:r.stopPropagation()}),this.cemeteryOverlayTitle=this.add.text(0,0,"Friedhof",{fontFamily:"monospace",fontSize:"18px",color:"#f1f2f6"}).setOrigin(.5,0),this.cemeteryListContainer=this.add.container(0,0),this.cemeteryOverlayList=this.add.text(0,0,"",{fontFamily:"monospace",fontSize:"12px",color:"#d1d9e6",lineSpacing:6}).setOrigin(0,0),this.cemeteryOverlayList.setWordWrapWidth(320),this.cemeteryListContainer.add(this.cemeteryOverlayList),this.cemeteryListMaskShape=this.add.graphics({x:0,y:0}),this.cemeteryListMaskShape.setVisible(!1),this.cemeteryMask=new b.Display.Masks.GeometryMask(this,this.cemeteryListMaskShape),this.cemeteryListContainer.setMask(this.cemeteryMask),this.cemeteryScrollArea=this.add.rectangle(0,0,320,260,16777215,0).setOrigin(0,0),this.cemeteryScrollArea.setInteractive({useHandCursor:!0}),this.cemeteryScrollArea.on("pointerdown",n=>{var r;(r=n.event)==null||r.stopPropagation()}),this.cemeteryScrollArea.on("wheel",(n,r,o,a,c)=>{c.stopPropagation(),this.adjustCemeteryScroll(o)}),this.cemeteryOverlayClose=this.add.text(0,0,"Schließen",{fontFamily:"monospace",fontSize:"12px",color:"#9da3ae"}).setOrigin(.5,.5),this.cemeteryOverlayClose.setInteractive({useHandCursor:!0}),this.cemeteryOverlayClose.on("pointerdown",()=>this.hideCemeteryOverlay()),this.cemeteryOverlay.add([this.cemeteryScrim,this.cemeteryOverlayBg,this.cemeteryOverlayTitle,this.cemeteryListMaskShape,this.cemeteryScrollArea,this.cemeteryListContainer,this.cemeteryOverlayClose]),this.cemeteryOverlay.setDepth(10),this.cemeteryOverlay.setVisible(!1)}updateCemeteryUI(){const e=this.world.state.officers.filter(s=>s.status!=="ALIVE");this.cemeteryCount.setText(`(${e.length})`),this.cemeteryButton.setAlpha(e.length>0?1:.6),this.updateCemeteryOverlayList(e)}updateCemeteryOverlayList(e){const s=this.cemeteryListWidth>0?this.cemeteryListWidth:320;if(this.cemeteryOverlayList.setWordWrapWidth(s),e.length===0){this.cemeteryOverlayList.setText("Noch keine Gefallenen."),this.cemeteryContentHeight=this.cemeteryOverlayList.height,this.refreshCemeteryScrollBounds();return}const n=e.map(r=>{const o=r.status==="MISSING"?"Vermisst":"Gefallen";return`• ${r.name} (${r.rank}, Lv ${r.level}) – ${o}`});this.cemeteryOverlayList.setText(n.join(`

`)),this.cemeteryContentHeight=this.cemeteryOverlayList.height,this.refreshCemeteryScrollBounds()}adjustCemeteryScroll(e){if(!this.cemeteryListContainer)return;const s=Math.max(0,this.cemeteryViewportHeight),n=Math.max(0,this.cemeteryContentHeight-s);if(n<=0){this.cemeteryScroll=0,this.refreshCemeteryScrollBounds();return}const r=Math.max(24,Math.round(s*.2)),o=e>0?1:-1;this.cemeteryScroll=b.Math.Clamp(this.cemeteryScroll+o*r,0,n),this.cemeteryListContainer.setPosition(this.cemeteryListX,this.cemeteryListY-this.cemeteryScroll)}refreshCemeteryScrollBounds(){if(!this.cemeteryListContainer)return;const e=Math.max(0,this.cemeteryViewportHeight),s=Math.max(0,this.cemeteryContentHeight-e);this.cemeteryScroll=b.Math.Clamp(this.cemeteryScroll,0,s),this.cemeteryListContainer.setPosition(this.cemeteryListX,this.cemeteryListY-this.cemeteryScroll)}showCemeteryOverlay(){this.updateCemeteryOverlayList(this.world.state.officers.filter(e=>e.status!=="ALIVE")),this.cemeteryScroll=0,this.refreshCemeteryScrollBounds(),this.cemeteryOverlay.setVisible(!0)}hideCemeteryOverlay(){this.cemeteryOverlay&&this.cemeteryOverlay.setVisible(!1)}toggleCemeteryOverlay(){this.cemeteryOverlay&&(this.cemeteryOverlay.visible?this.hideCemeteryOverlay():this.showCemeteryOverlay())}layoutWarcallIcons(){if(!this.warcallIconBarBg)return;const e=this.warcallIcons.size;if(e===0){this.warcallIconBar.setVisible(!1);return}this.warcallIconBar.setVisible(!0);const s=this.warcallIconBarBg.displayWidth,n=this.warcallIconBarBg.displayHeight,r=72,o=e>1?Math.max(14,Math.min(36,(s-r*e)/(e-1))):0,a=e*r+Math.max(0,e-1)*o,c=Math.max(0,(s-a)/2);let l=0;this.warcallIcons.forEach(h=>{const u=c+r/2+l*(r+o),y=n/2;h.setPosition(u,y),l+=1})}applyWarcallIconVisuals(e){const s=this.warcallIcons.get(e),n=this.warcallIconMeta.get(e);if(!s||!n)return;const r=s.getData("hover")===!0,o=s.getData("highlight")===!0,a=s.getData("selected")===!0,c=r||a?16170336:o?5032432:2306881,l=r||a?1:o?.9:.7,h=r||a?3:2;n.bg.setStrokeStyle(h,c,l),s.setScale(r||a?1.08:1)}createWarcallIcon(e){const s=this.add.container(0,0);s.setSize(76,76),s.setDepth(1.3);const n=this.add.rectangle(0,0,68,68,1318955,.92).setOrigin(.5),r=this.add.text(0,-10,v[e.type],{fontFamily:"monospace",fontSize:"28px",color:"#f7f9fc"}).setOrigin(.5),o=this.add.text(0,14,w[e.type],{fontFamily:"monospace",fontSize:"10px",color:"#d1d9e6"}).setOrigin(.5,0),a=this.add.text(0,30,"",{fontFamily:"monospace",fontSize:"10px",color:"#a9b7c6"}).setOrigin(.5,0);return s.add([n,r,o,a]),s.setDataEnabled(),s.setData({hover:!1,highlight:!1,selected:!1,warcallId:e.id}),s.setInteractive(new b.Geom.Rectangle(-34,-34,68,68),b.Geom.Rectangle.Contains),s.on("pointerover",()=>{s.setData("hover",!0),this.applyWarcallIconVisuals(e.id),this.input.setDefaultCursor("pointer")}),s.on("pointerout",()=>{s.setData("hover",!1),this.applyWarcallIconVisuals(e.id),this.input.setDefaultCursor("default")}),s.on("pointerdown",()=>{const c=s.getData("warcallId"),l=this.world.state.warcalls.find(h=>h.id===c&&h.state!=="RESOLVED");l&&this.showWarcallDetails(l)}),this.warcallIconMeta.set(e.id,{bg:n,icon:r,label:o,chance:a}),s}updateWarcallIcon(e,s){const n=this.warcallIcons.get(e.id),r=this.warcallIconMeta.get(e.id);!n||!r||(n.setData("warcallId",e.id),n.setData("highlight",s),n.setData("selected",this.focusedWarcallId===e.id),r.icon.setText(v[e.type]),r.label.setText(w[e.type]),r.chance.setText(`${Math.round(this.computeWarcallSuccess(e)*100)}%`),this.applyWarcallIconVisuals(e.id))}syncWarcallIcons(e){const s=this.world.state.warcalls.filter(o=>o.state!=="RESOLVED"),n=new Set((e==null?void 0:e.newWarcalls.map(o=>o.id))??[]),r=new Set;s.forEach(o=>{let a=this.warcallIcons.get(o.id);a||(a=this.createWarcallIcon(o),this.warcallIcons.set(o.id,a),this.warcallIconBar.add(a)),this.updateWarcallIcon(o,n.has(o.id)),r.add(o.id)}),this.warcallIcons.forEach((o,a)=>{r.has(a)||(o.destroy(!0),this.warcallIcons.delete(a),this.warcallIconMeta.delete(a))}),this.layoutWarcallIcons()}focusWarcall(e){this.focusedWarcallId=e.id,this.focusRoles.clear();const s=this.getOfficerById(e.initiator);this.collectParticipantIds(e).forEach(r=>{const o=this.getOfficerById(r),a=o?Q(e,o,s):r===e.initiator?"Ausrufer":"Supporter",c=this.determineFocusRole(a,r===e.initiator);this.focusRoles.set(r,c)}),e.hiddenRoles.forEach(r=>{this.focusRoles.has(r.who)||this.focusRoles.set(r.who,this.mapHiddenRole(r.role))})}clearWarcallSelection(){if(!this.focusedWarcallId){this.detailMode==="WARCALL"&&this.showDefaultDetails();return}this.focusedWarcallId=null,this.focusRoles.clear(),this.detailMode==="WARCALL"&&this.showDefaultDetails(),this.syncOfficerTokens(this.lastSummary),this.syncWarcallIcons(this.lastSummary),this.refreshWarcalls(this.lastSummary),this.drawConnections(this.lastSummary)}showWarcallDetails(e){this.detailMode="WARCALL",this.detailLabel.setText("Details – Warcall"),this.focusWarcall(e);const s=v[e.type],n=w[e.type],r=Be[e.type],o=Math.round(this.computeWarcallSuccess(e)*100),a=this.getOfficerById(e.initiator),c=a?a.name:this.getOfficerShortName(e.initiator),l=this.collectParticipantIds(e),h=l.map(T=>{const p=this.getOfficerById(T),A=p?p.name:this.getOfficerShortName(T),E=p?Q(e,p,a):T===e.initiator?"Ausrufer":"Teilnehmer";return`• ${A} – ${E}`}),u=e.hiddenRoles.filter(T=>!l.includes(T.who)),y=u.length>0?[`Verdeckte Beteiligte: ${u.map(T=>`${this.getOfficerShortName(T.who)} – ${T.role}`).join(", ")}`]:[],S=e.rewards.titles.length>0?`Titel: ${e.rewards.titles.join(", ")}`:void 0,g=[`${s} ${n} @ ${e.location}`,`Initiator: ${c}`,`Ziel: ${r}`,`Belohnung: ${e.rewards.merit} Merit • ${e.rewards.xp} XP`];S&&g.push(S),g.push(`Erfolgschance für ${this.getOfficerShortName(e.initiator)}: ${o}%`),g.push("","Beteiligte:"),g.push(...h),y.length>0&&g.push("",...y),this.detailText.setText(g.join(`
`)),this.syncOfficerTokens(this.lastSummary),this.syncWarcallIcons(this.lastSummary),this.refreshWarcalls(this.lastSummary),this.drawConnections(this.lastSummary)}validateWarcallFocus(){if(!this.focusedWarcallId)return;this.world.state.warcalls.some(s=>s.id===this.focusedWarcallId&&s.state!=="RESOLVED")||(this.focusedWarcallId=null,this.focusRoles.clear(),this.detailMode==="WARCALL"&&this.showDefaultDetails())}collectParticipantIds(e){const s=e.participants.includes(e.initiator)?e.participants:[e.initiator,...e.participants];return Array.from(new Set(s))}determineFocusRole(e,s){if(s)return"leader";const n=e.toLowerCase();return n.includes("assassin")||n.includes("assassine")?"hidden":n.includes("verdeckt")||n.includes("rival")?"rival":n.includes("verbünd")||n.includes("loyal")?"ally":"support"}mapHiddenRole(e){switch(e.toUpperCase()){case"ASSASSIN":return"hidden";case"TRAITOR":return"rival";case"LOYALIST":return"ally";default:return"support"}}getOfficerShortName(e){const s=this.world.state.officers.find(r=>r.id===e);if(!s)return e.slice(0,6);const n=li(s.name);return s.rank==="König"?`👑 ${n}`:n}}const z=Y();class hi extends z.Game{constructor(i){const e={type:z.AUTO,parent:i,backgroundColor:"#0b0d10",width:window.innerWidth,height:window.innerHeight,pixelArt:!0,scale:{mode:z.Scale.RESIZE,autoCenter:z.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0}}},scene:[Le,ci]};super(e)}}new hi(document.getElementById("app"));
